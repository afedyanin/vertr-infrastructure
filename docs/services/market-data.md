# Market Data

## Назначение 

Броадкаст маркетных данных

## Функционал

### Rest API
- подписка/отписка от маркетных данных через REST запросы
- получение статики по REST

### Kafka Topics

#### Consumers
- слушает топики от TProxy с маркет данными

### Redis
- публикация маркетных данных из топиков TProxy
- публикация статики

## Особенности реализации
- Источники данных абстрагированы через топики Кафки


## Backlog

### 2024-09-06

#### MVP0 - Маркет дата в самом простом виде - принимает сообщения из кафки и публикует их в редис.

1. Сделать бэкграунд сервис с рандомной публикацией данных в редис по заданному интервалу времени.

2. Сделать публикацию данных, которые приходят в кафка-консьюмер
- реализовать консьюмер
- реализовать клиента, который умеет подписываться и отписываться от маркет даты в TKS API
- реализовать продюсер в Редис

3. Добавить отправку данных через OpenTelemetry - в прометеус и графану.
- Реализовать счетчики
- Реализовать экспортер в Прометеус
- Настроить дашборды в Графане

#### На стороне инфры

- реализовать клиента для Редиса
- реализовать базовый слой работы с OpenTelemetry (нугет пакет для сервисного слоя - хостов)
- добавить в слой инфраструктуры прометеус и графану (docker compose)
- реализовать сбор и публикацию системных метрик от инфраструктуры (TProxy, Kafka, Redis, PgSQL)


#### Полновесный MDS

Два типа хранилища
- Cold - исторические данные
- Hot - текущие данные по торговой сессии

Данные для Cold загружаются отдельно через Loader исторических данных. 
Лоадер настраивается через конфиг и шедулер. Данные загружаются в PgSQL.
К Cold данным относятся в тч. макроэкономика (ставка ЦБ), статик дата, данные, которые расчитываются по итогам торговой сессии (фиксинги)

Источники Cold:
- исторические данные Tproxy
- ИСС (в том числе статик дата)
- MOEX
- Финам
- Алор
- и тп.

Данные для Hot - через кафку от подключенного коннектора (TProxy, Quik, Финам, Алор).
Полагаем, что стратегии не работают непосредственно с потоками трейдов и ордер буками, а работают с производными индикаторами от них.
Поэтому есть отдельный сервис, формирующий эти индикаторы - Measuments и публикующий данные по ним в Redis.

Примеры Measument
- price open/close/avg/high/low
- price change
- price change percent
- volume
- candle (OHLCV)
- FV, PV, VAR и другие деривативы (см. Quantlib)
- RSI
- EMA 10/20/30
- SMA 10/20/30
- trades per 1s/1m/1h
- sell/buy orders per 1s/1m/1h
- и т.п.

Measument сервис может формировать стрим или ключ в редисе по запросу от клиента, по которому клиент сможет забирать данные.
Клиент сам собирает из набора Measuments нужный датафрейм для обучения DL,ML моделей.
Любой Measument реализуется как Ring Buffer с заданным конечным количеством значений - нужно продумать API этой структуры.

Кейс:
- клиент (стратегия) для формирования DF подписывается на Measuments и получает данные по ним
- Measuments Service из метаданных реквеста извлекеает информацию по инструментам, измерениям, необходимым таймфремам и таймсериям
- Measuments Service самостоятельно определяет местонахождение запрашиваемых данных - Hot/Cold.
- Measuments Service подписывается либо извлекает из БД необходимые raw данные, строит по ним запрошенные производные данные и публикует их в стрим либо в редис
- клиент из полученных данный формирует DF, который отправляется в модель либо для обучения, либо для прогноза


### 2024-08-07

- создать репозиторий и солюшен
- добавить клиента для TProxy и реализовать слой Infrastructure
- реализовать домен
- реализовать функционал подписки/отписки от MD через Rest
- реализовать функционал публикации данных в Redis
- реализовать клиента и контракты данных для чтения из Redis
- персистентное хранилище статики в pgSQL
- мапинг индентификаторов инструментов из TProxy на нативные - ISIN и/или Ticker+ClassCode
- реализовать UI дашборд по маркет дате?
- реализовать базовые типовые индикаторы





